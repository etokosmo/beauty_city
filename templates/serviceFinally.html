<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Beauty City</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="{% static 'css/jquery.arcticmodal-0.3.css' %}">
	<link rel="stylesheet" href="{% static 'css/simple.css' %}">
	<link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/air-datepicker.css' %}">
	
	<link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
	<section id="mobMenu">
			<div class="mobMenu">
				<div class="container">
				<div class="mobMenu__header">
					<div class="row">
						<div class="col-4 col-md-3">
							<a href="../">
								<img src="{% static 'img/Logo.svg' %}" alt="Logo" class="logo header__logo">
							</a>
						</div>
						<div class="col-3 col-md-2">
							<img src="{% static 'img/x.svg' %}" alt="x" class="mobMenuClose">
						</div>
					</div>
				</div>
				<div class="mobMenu__content">
					<div class="row">
						<div class="col-md-3">
							<nav>
								<ul class="mobMenu__menu">
									<li class="mobMenu__menu_item">
										<a href="#" class="mobMenu__menu_link">Мастера</a>
									</li>
									<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">Услуги</a></li>
									<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">Отзывы</a></li>
									<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">Контакты</a></li>
								</ul>
							</nav>
							<a href="note" class="mobMenu__account">Личный кабинет</a>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<button class="mobMenu__btn">Перезвоните мне</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<header id="header">
		<div class="container">
			<div class="header">
				<div class="row">
					<div class="col-2 col-md-2 mob">
						<img src="{% static 'img/hamburger.svg' %}" alt="hamburger" class="header__mobMenu">
					</div>
					<div class="col-5 col-md-3 col-lg-2">
						<a href="../">
							<img src="{% static 'img/Logo.svg' %}" alt="Logo" class="logo header__logo">
						</a>
					</div>
					<div class="col-md-5 ">
						<nav>
						<ul class="menu">
							<li class="menu__item"><a href="#" class="menu__item_link">Мастера</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">Услуги</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">Отзывы</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">Контакты</a></li>
						</ul>
					</nav>
					</div>
					<div class="col-2 col-md-2 col-lg-3">
						<div class="header__block">
						<button class="header__block_btn">Перезвоните мне</button>
						{% if client %}
							{% if client_info.image %}
							<img src="{{client_info.image}}" alt="account" class="header__account_img">
							{% else %}
							<img src="{% static 'img/acc.svg' %}" alt="account" class="header__account_img">
							{% endif %}
							<a href="{% url 'service:note_page' %}" class="menu__item_link">Личный кабинет</a>
							<span class="menu__item_link" style="margin-left: 20px"></span>
							<a href="{% url 'service:logout_user' %}" class="menu__item_link">Выйти</a>

						{% else %}
						<div class="header__block_auth">
							<img src="{% static 'img/acc.svg' %}" alt="account" class="header__account_img">
							<span class="header__block_auth__intro">Войти</span>
						</div>
                            {% endif %}
					</div>
					</div>
				</div>
				
				
				
			</div>
		</div>
	</header>
	<section id="serviceFinally">
		<div class="container">
			<div class="serviceFinally">
				<div class="row">
					<div class="col-md-6 col-lg-6">
						<div class="breadCrumbs">
							<a href="../" class="breadCrumbs__item">На главную</a>
						</div>
						<div class="service__block">
							<h1 class="service__title">Запись на услугу</h1>
						</div>
						<form action="#" class="serviceFinally__form">
							{%  for timeslot in timeslots %}
							<div class="serviceFinally__form_block">
								<div class="serviceFinally__form_header fic">
									<span class="serviceFinally__form_header__number">Запись №{{timeslot.id}}</span>
									<div class="serviceFinally__form_header__item fic">
										<div class="serviceFinally__form_header__service">{{timeslot.salon}}</div>
										<div class="serviceFinally__form_header__address">{{timeslot.salon_address}}</div>
									</div>
								</div>
								<div class="serviceFinally__form_content">
									<div class="serviceFinally__form_content__block fic">
										<div class="serviceFinally__form_content__title">{{timeslot.service_title}}</div>
										<div class="serviceFinally__form_content__price">{{timeslot.service_price}} ₽</div>
									</div>
									<div class="serviceFinally__form_content__block fic">
										<div class="serviceFinally__form_content__items fic">
										  	<img src="{{timeslot.master_image}}" style="max-height: 100px;"
												 alt="avatar" class="accordion__block_img">
										  	<div class="accordion__block_master">{{timeslot.master_first_name}}
												{{timeslot.master_second_name}}</div>
									    </div>
									    <div class="serviceFinally__form_content__item fic">
											<div class="serviceFinally__form_content__time">{{timeslot.time}}</div>
											<div class="serviceFinally__form_content__date">{{timeslot.day}}</div>
										</div>
									</div>
								</div>
							</div>
							{% endfor %}

							<div class="serviceFinally__form_itesm">
								<div class="contacts__form_block fic">
									<input type="text" name="fname" class="contacts__form_iunput" placeholder="Введите имя" required="">
									<div class="contacts__form_inputBlock">
										<input type="text" name="tel" class="contacts__form_iunput" placeholder="+7(999)999--99-99" required="">
									</div>
								</div>

								<textarea name="contactsTextarea" class="contacts__form_textarea" placeholder="Вопрос(необязательно)"></textarea>
								<div class="contacts__form_checkboxBlock fic">
									<input type="checkbox" class="contacts__form_checkbox" checked="">
									<span class="contacts__form_checkboxBlock__intro">Я согласен(а) с политикой конфидециоальности</span>
<!--								<button type="submit" class="serviceFinallys__form_btn">Записаться</button>-->
<!--								<button type="submit" class="serviceFinallys__form_back">Назад</button>-->
								</div>
								<a href="../create_order" class="serviceFinallys__form_back">Записаться</a>
								<a href="../create_order" style="margin-left: 20px; " class="serviceFinallys__form_back">Назад</a>
							</div>
						</form>
					</div>
					<div class="col-md-12 col-lg-5">
						<img src="{% static 'img/bannerImg.svg' %}" alt="bannerImg" class="banner__img">
					</div>
				</div>
			</div>
		</div>
	</section>
	<footer id="footer">
		<div class="container">
			<div class="footer">
				<div class="footer__block">
					<div class="row">
						<div class="col-md-3 col-lg-2">
							<a href="/"><img src="{% static 'img/Logo.svg' %}" alt="logo" class="footer__logo"></a>
						</div>
						<div class="col-md-5 minMobHide">
							<nav>
								<ul class="menu">
									<li class="menu__item"><a href="#" class="menu__item_link">Мастера</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">Услуги</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">Отзывы</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">Контакты</a></li>
								</ul>
							</nav>
						</div>
					</div>
					<div class="footer__contact">
						<div class="row">
							<div class="col-md-4">
								
									<div class="footer__data">с 10:00 до 20:00  без выходных</div>
									
							</div>
							<div class="col-md-3">
								<a href="tel:+79179023800" class="contacts__info_tel">+7 (917) 902 38 00</a>
							</div>
						</div>
						<div class="row">
							<div class="col-md-5 minMobShow">
								<nav>
									<ul class="menu">
										<li class="menu__item"><a href="#" class="menu__item_link">Мастера</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">Услуги</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">Отзывы</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">Контакты</a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
					<hr class="hr"></hr>
					<div class="footer__bottom">
						<div class="row">
							<div class="col-md-4 col-lg-3">
								<a href="#" class="footer__link">Политика конфиденциальности</a>
							</div>
							<div class="col-md-3">
								<div class="footer__copy">2022. Все права защищены</div>
							</div>
							<div class="col-md-3 col-lg-2">
								<div class="footer__social fic">
									<a href=""><img src="{% static 'img/waGray.svg' %}" alt="wa" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/vkGray.svg' %}" alt="vk" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/tgGray.svg' %}" alt="tg" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/instaGray.svg' %}" alt="insta" class="contacts__social_icon"></a>
								</div>
							</div>
						</div>
						
						
						
					</div>
					
				</div>
			</div>
		</div>
	</footer>
	<div style="display: none;">
		<div class="box-modal authPopup popup" id="authModal">
			<div class="box-modal_close arcticmodal-close"><img src="{% static 'img/x.svg' %}" alt="x"></div>
			<div class="popup__title authPopup__title">Войти по коду</div>
			<p class="popup__text authPopup__text">Введите свой номер телефона, мы вышлем на него код</p>
			<form action="" class="authPopup__form">
				{% csrf_token %}
				<div class="contacts__form_inputBlock">
					<input type="text" name="tel" class="contacts__form_iunput" placeholder="+7 (999) 999-99-99" required="">
				</div>
				<div class="contacts__form_checkboxBlock fic">
					<input type="checkbox" class="contacts__form_checkbox" checked="" onchange="document.getElementById('submitFF').disabled = !this.checked">
					<span class="contacts__form_checkboxBlock__intro">Я согласен(а) с <a href="{{privacy_file.file.url}}" target="_blank">политикой конфиденциальности</a></span>
				</div>
				<button type="submit" class="popup__btn authPopup__btn" id="submitFF">Отправить</button>
			</form>
		</div>
	</div>
	<div style="display: none;">
		<div class="box-modal confirmPopup popup" id="confirmModal">
			<div class="box-modal_close arcticmodal-close"><img src="{% static 'img/x.svg' %}" alt="x"></div>
			<div class="popup__title confirmPopup__title">Подтвердите номер</div>
			<p class="popup__text confirmPopup__text">Введите код, полученный по SMS на номер <span id="tel1"></span> </p>
			<div class="confirmPopup__number">
				<input type="text" name="num1" class="tipsPopup__form_inputNum popup__input" placeholder="" required="" onchange='firstvalue_eventForm(this.value)'>
				<input type="text" name="num2" class="tipsPopup__form_inputNum popup__input" placeholder="" required="" onchange='secondvalue_eventForm(this.value)'>
				<input type="text" name="num3" class="tipsPopup__form_inputNum popup__input" placeholder="" required="" onchange='thirdvalue_eventForm(this.value)'>
				<input type="text" name="num4" class="tipsPopup__form_inputNum popup__input" placeholder="" required="" onchange='fourthvalue_eventForm(this.value)'>
				<button id="myButton">Подтвердить</button>
			</div>
			<div class="confirmPopup__sms">Если SMS не пришло вы можете <a href="#" class="popup__link">запросить код повторно</a></div>
			<div class="confirmPopup__changeNumber">
				<a href="#" class="confirmPopup__link popup__link">Изменить номер телефона</a>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js" integrity="sha512-XtmMtDEcNz2j7ekrtHvOVR4iwwaD6o/FUJe6+Zq+HgcCsk3kj4uSQQR8weQ2QVj1o0Pk6PwYLohm206ZzNfubg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="{% static 'js/air-datepicker.js' %}"></script>
	<script src="{% static 'js/jquery.arcticmodal-0.3.min.js' %}"></script>
	<script src="{% static 'js/main.js' %}"></script>

<script>
    async function fetchAsync (url) {
  let response = await fetch(url);
  return await response.json();
}

async function foobar() {
    let data = await fetchAsync('http://127.0.0.1:8000/create_order/')

    console.log(data)
    const el = document.getElementById('orders');

    el.innerHTML = ''
    data.forEach(function(item, i, data){
        let div = document.createElement('div');
        div.className = "serviceFinally__form_itesm";
        div.innerHTML = '<div class="accordion__block_intro">' + item.fields.title + '</div><div class="accordion__block_address">' + item.fields.address + '</div>'
        el.append(div)
    })
}
choose_salon.addEventListener("click", foobar);
</script>
	<script>
	var firstvalue = null;
	var secondvalue = null;
	var thirdvalue = null;
	var fourthvalue = null;
		function firstvalue_eventForm(value) {
		  firstvalue = value;
		}
		function secondvalue_eventForm(value) {
		  secondvalue = value;
		}
		function thirdvalue_eventForm(value) {
		  thirdvalue = value;
		}
		function fourthvalue_eventForm(value) {
		  fourthvalue = value;

		}

	</script>
<script>
		function check() {
			if ((!!firstvalue) & (!!secondvalue) & (!!thirdvalue) & (!!fourthvalue)) {
				var code = firstvalue + secondvalue + thirdvalue + fourthvalue
				let response = fetch('/verify_user/', {
				  method: 'POST',
				  body: JSON.stringify({"passcode": code}),
				  headers: {
					'Content-type': 'application/json; charset=UTF-8',
					'X-CSRFToken': '{{csrf_token}}',
            		}
        		})
        		.then(r =>  r.json().then(data => ({result: data['result'], jwt: data['user_phone_number']})))
                .then(obj => setCookie('user_phone_number',obj['jwt']));
                return true
			}
			return false
		}
</script>
<script>
	var myBtn = document.getElementById('myButton');

	myBtn.addEventListener('click', function(event) {
		a = check();
		setTimeout(() => {
		if (a === false) {
		    alert('Заполните все поля!');
		} else {
			jwt = getCookie('user_phone_number');
			let isEmpty = Object.entries(jwt).length === 0;
			if (isEmpty === true) {
				alert('Неправильный код');
           	} else {
				location.reload(true);
           	 }
        }
}, 500)

	});
</script>
<script>
    function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}
function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
</script>
<script>
maskPhone('.contacts__form_iunput');
function maskPhone(selector, masked = '+7 (___) ___-__-__') {
	const elems = document.querySelectorAll(selector);

	function mask(event) {
		const keyCode = event.keyCode;
		const template = masked,
			def = template.replace(/\D/g, ""),
			val = this.value.replace(/\D/g, "");
		console.log(template);
		let i = 0,
			newValue = template.replace(/[_\d]/g, function (a) {
				return i < val.length ? val.charAt(i++) || def.charAt(i) : a;
			});
		i = newValue.indexOf("_");
		if (i !== -1) {
			newValue = newValue.slice(0, i);
		}
		let reg = template.substr(0, this.value.length).replace(/_+/g,
			function (a) {
				return "\\d{1," + a.length + "}";
			}).replace(/[+()]/g, "\\$&");
		reg = new RegExp("^" + reg + "$");
		if (!reg.test(this.value) || this.value.length < 5 || keyCode > 47 && keyCode < 58) {
			this.value = newValue;
		}
		if (event.type === "blur" && this.value.length < 5) {
			this.value = "";
		}

	}

	for (const elem of elems) {
		elem.addEventListener("input", mask);
		elem.addEventListener("focus", mask);
		elem.addEventListener("blur", mask);
	}

}

</script>
</body>
</html>